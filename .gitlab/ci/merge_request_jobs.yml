# Holds jobs that run from a merge request

premerge_check:
  rules:
    - !reference [.default_rules, rules]
  extends: .premerge_check_template
  image: espressif/idf:latest

build_idf_v5.5:
  rules:
    - !reference [.default_rules, rules]
  extends: .build_template
  image: espressif/idf:${IDF_VER}
  parallel:
    matrix:
      - IDF_VER: ["v5.5", "v5.5.1", "release-v5.5"]
        IDF_TARGET: ["esp32p4"]
        IDF_SLAVE_TARGET: ["esp32c6", "esp32c5"]
        IDF_EXAMPLE_PATH: ["examples/wifi/iperf"]

### build mqtt/tcp example mqtt/tcp sdkconfig.ci.p4_wifi
build_idf_master_mqtt_tcp:
  variables:
    EXAMPLE_CI_FILE: "sdkconfig.ci.p4_wifi"
  rules:
    - !reference [.default_rules, rules]
  extends: .build_template
  image: espressif/idf:latest
  parallel:
    matrix:
      - IDF_TARGET: ["esp32p4"]
        IDF_SLAVE_TARGET: ["esp32c6", "esp32c5", "esp32c61"]
        IDF_EXAMPLE_PATH: ["examples/protocols/mqtt/tcp"]

build_idf_master_iperf:
  rules:
    - !reference [.default_rules, rules]
  extends: .build_template
  image: espressif/idf:latest
  parallel:
    matrix:
      - IDF_TARGET: ["esp32p4"]
        IDF_SLAVE_TARGET: ["esp32c6", "esp32c5", "esp32c61"]
        IDF_EXAMPLE_PATH: ["examples/wifi/iperf"]

build_coprocessor_idf_v5.5:
  rules:
    - !reference [.default_rules, rules]
  extends: .build_template_coprocessor
  image: espressif/idf:${IDF_VER}
  parallel:
    matrix:
      - IDF_TARGET: ["esp32c6", "esp32c5"]
        IDF_VER: ["v5.5", "v5.5.1", "release-v5.5"]
        SLAVE_CI_FILE: ["sdio", "spi", "spi_hd", "uart"]

build_coprocessor_idf_master:
  rules:
    - !reference [.default_rules, rules]
  extends: .build_template_coprocessor
  image: espressif/idf:latest
  parallel:
    matrix:
      - IDF_TARGET: ["esp32c6", "esp32c5"]
        SLAVE_CI_FILE: ["sdio", "spi", "spi_hd", "uart"]

# for C61, build for sdio only for now
build_coprocessor_idf_master_c61:
  rules:
    - !reference [.default_rules, rules]
  extends: .build_template_coprocessor
  image: espressif/idf:latest
  parallel:
    matrix:
      - IDF_TARGET: ["esp32c61"]
        SLAVE_CI_FILE: ["sdio" ]
